2022-10-24 13:55:12,008 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 13:55:12,008 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 13:55:12,998 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 13:55:13,016 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 13:55:13,981 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 13:55:17,168 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 13:55:17,170 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 13:56:39,106 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 295, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 124, in _forward_1st_stage
    predictions = self.asr_brain.compute_forward(batch, rs.Stage.ATTACK)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 59, in compute_forward
    wavs = self.hparams.augmentation(wavs, wav_lens)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/speechbrain/speechbrain/lobes/augment.py", line 293, in forward
    waveforms = self.speed_perturb(waveforms)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/speechbrain/speechbrain/processing/speech_augmentation.py", line 474, in forward
    perturbed_waveform = self.resamplers[self.samp_index](waveform)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/speechbrain/speechbrain/processing/speech_augmentation.py", line 568, in forward
    resampled_waveform = self._perform_resample(waveforms)
  File "/home/rolivier/workspace/libs/speechbrain/speechbrain/processing/speech_augmentation.py", line 643, in _perform_resample
    weight=self.weights[i].repeat(num_channels, 1, 1),
KeyboardInterrupt
2022-10-24 13:56:54,179 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 13:56:54,179 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 13:56:55,116 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 13:56:55,130 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 13:56:56,047 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 13:56:59,345 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 13:56:59,348 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 13:57:39,099 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 316, in _attack_1st_stage
    batch.tokens[local_batch_size_idx]
KeyboardInterrupt
2022-10-24 13:58:09,286 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 13:58:09,287 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 13:58:10,169 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 13:58:10,183 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 13:58:11,107 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 13:58:14,269 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 13:58:14,272 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 13:59:22,379 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 316, in _attack_1st_stage
    batch.tokens[local_batch_size_idx]
KeyboardInterrupt
2022-10-24 13:59:30,176 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 13:59:30,179 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 13:59:31,082 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 13:59:31,096 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 13:59:32,003 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 13:59:35,195 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 13:59:35,197 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 13:59:42,416 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 295, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 134, in _forward_1st_stage
    val_predictions = self.asr_brain.compute_forward(batch, sb.Stage.VALID)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 70, in compute_forward
    result = self.modules.whisper.model.transcribe(
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 93, in transcribe
    _, probs = model.detect_language(segment)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 43, in detect_language
    mel = model.encoder(mel)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 156, in forward
    x = block(x)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 127, in forward
    x = x + self.mlp(self.mlp_ln(x))
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/container.py", line 141, in forward
    input = module(input)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 37, in forward
    x, self.weight.to(x.dtype), None if self.bias is None else self.bias.to(x.dtype)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1164, in __getattr__
    def __getattr__(self, name: str) -> Union[Tensor, 'Module']:
KeyboardInterrupt
2022-10-24 14:02:14,762 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:02:14,763 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:02:15,699 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:02:15,714 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:02:16,633 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:02:19,803 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:02:19,805 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:13:29,270 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 295, in _attack_1st_stage
    _,
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 124, in _forward_1st_stage
    predictions = self.asr_brain.compute_forward(batch, rs.Stage.ATTACK)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 75, in compute_forward
    result = self.modules.whisper.model.loss(
  File "/home/rolivier/workspace/whisper/loss.py", line 380, in get_loss_single_segment
    result: LossResult = get_loss_from_mel(
  File "/home/rolivier/workspace/whisper/loss.py", line 138, in get_loss_from_mel
    result = LossTask(model, confidence, correct_first_word, options).run(mel,label)
  File "/home/rolivier/workspace/whisper/loss.py", line 66, in run
    init_tokens: Tensor = torch.tensor([self.initial_tokens]).repeat(n_audio, 1).to(audio_features.device)
KeyboardInterrupt
2022-10-24 14:13:52,340 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:13:52,341 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:13:53,323 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:13:53,337 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:13:54,394 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:13:57,574 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:13:57,576 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:14:16,727 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 134, in _forward_1st_stage
    self.asr_brain.module_eval()
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 70, in compute_forward
    result = self.modules.whisper.model.transcribe(
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 180, in transcribe
    result: DecodingResult = decode_with_fallback(segment)
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 117, in decode_with_fallback
    decode_result = model.decode(segment, options)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 696, in decode
    result = DecodingTask(model, options).run(mel)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 628, in run
    tokens, sum_logprobs, no_speech_probs = self._main_loop(audio_features, tokens)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 597, in _main_loop
    tokens, completed = self.decoder.update(tokens, logits, sum_logprobs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 259, in update
    next_tokens = Categorical(logits=logits / temperature).sample()
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/distributions/categorical.py", line 64, in __init__
    super(Categorical, self).__init__(batch_shape, validate_args=validate_args)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/distributions/distribution.py", line 62, in __init__
    if not constraint.check(getattr(self, param)).all():
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/distributions/constraints.py", line 207, in check
    result = result.all(-1)
KeyboardInterrupt
2022-10-24 14:14:23,065 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:14:23,067 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:14:23,735 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:14:23,748 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:14:24,657 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:14:27,825 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:14:27,827 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:33:07,961 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 124, in _forward_1st_stage
    predictions = self.asr_brain.compute_forward(batch, rs.Stage.ATTACK)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 75, in compute_forward
    result = self.modules.whisper.model.loss(
  File "/home/rolivier/workspace/whisper/loss.py", line 380, in get_loss_single_segment
    result: LossResult = get_loss_from_mel(
  File "/home/rolivier/workspace/whisper/loss.py", line 138, in get_loss_from_mel
    result = LossTask(model, confidence, correct_first_word, options).run(mel,label)
  File "/home/rolivier/workspace/whisper/loss.py", line 79, in run
    tokens = tokens.repeat_interleave(self.n_group, dim=0).to(audio_features.device)
KeyboardInterrupt
2022-10-24 14:33:14,466 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:33:14,467 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:33:15,385 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:33:15,400 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:33:16,307 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:33:19,518 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:33:19,521 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:36:43,523 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 305, in _attack_1st_stage
    loss.backward()
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/_tensor.py", line 307, in backward
    torch.autograd.backward(self, gradient, retain_graph, create_graph, inputs=inputs)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/__init__.py", line 154, in backward
    Variable._execution_engine.run_backward(
KeyboardInterrupt
2022-10-24 14:38:56,050 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:38:56,051 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:38:56,933 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:38:56,947 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:38:57,947 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:39:01,130 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:39:01,132 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:40:56,140 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 135, in _forward_1st_stage
    val_predictions = self.asr_brain.compute_forward(batch, sb.Stage.VALID)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 70, in compute_forward
    result = self.modules.whisper.model.transcribe(
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 180, in transcribe
    result: DecodingResult = decode_with_fallback(segment)
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 117, in decode_with_fallback
    decode_result = model.decode(segment, options)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 696, in decode
    result = DecodingTask(model, options).run(mel)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 628, in run
    tokens, sum_logprobs, no_speech_probs = self._main_loop(audio_features, tokens)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 586, in _main_loop
    logits = self.inference.logits(tokens, audio_features)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 144, in logits
    res = self.model.decoder(tokens, audio_features, kv_cache=self.kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 189, in forward
    x = block(x, xa, mask=self.mask, kv_cache=kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 126, in forward
    x = x + self.cross_attn(self.cross_attn_ln(x), xa, kv_cache=kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 73, in forward
    q = self.query(x)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 36, in forward
    return F.linear(
KeyboardInterrupt
2022-10-24 14:41:02,724 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:41:02,725 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:41:03,689 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:41:03,704 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:41:04,797 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:41:07,988 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:41:07,990 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:48:44,819 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 135, in _forward_1st_stage
    val_predictions = self.asr_brain.compute_forward(batch, sb.Stage.VALID)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 70, in compute_forward
    result = self.modules.whisper.model.transcribe(
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 180, in transcribe
    result: DecodingResult = decode_with_fallback(segment)
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 117, in decode_with_fallback
    decode_result = model.decode(segment, options)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 696, in decode
    result = DecodingTask(model, options).run(mel)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 628, in run
    tokens, sum_logprobs, no_speech_probs = self._main_loop(audio_features, tokens)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 586, in _main_loop
    logits = self.inference.logits(tokens, audio_features)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 144, in logits
    res = self.model.decoder(tokens, audio_features, kv_cache=self.kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 189, in forward
    x = block(x, xa, mask=self.mask, kv_cache=kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 124, in forward
    x = x + self.attn(self.attn_ln(x), mask=mask, kv_cache=kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 86, in forward
    return self.out(wv)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 36, in forward
    return F.linear(
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/functional.py", line 1848, in linear
    return torch._C._nn.linear(input, weight, bias)
KeyboardInterrupt
2022-10-24 14:49:15,721 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:49:15,722 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:49:16,669 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:49:16,683 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:49:17,605 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:49:20,812 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:49:20,814 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:50:33,842 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 124, in _forward_1st_stage
    predictions = self.asr_brain.compute_forward(batch, rs.Stage.ATTACK)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 75, in compute_forward
    result = self.modules.whisper.model.loss(
  File "/home/rolivier/workspace/whisper/loss.py", line 380, in get_loss_single_segment
    result: LossResult = get_loss_from_mel(
  File "/home/rolivier/workspace/whisper/loss.py", line 138, in get_loss_from_mel
    result = LossTask(model, confidence, correct_first_word, options).run(mel,label)
  File "/home/rolivier/workspace/whisper/loss.py", line 82, in run
    loss, logits, no_speech_probs, sum_logprobs = self._decoder_forward(audio_features, tokens, init_tokens_length)
  File "/home/rolivier/workspace/whisper/loss.py", line 52, in _decoder_forward
    logits = self.inference.logits(tokens[:,:-1], audio_features)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 144, in logits
    res = self.model.decoder(tokens, audio_features, kv_cache=self.kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 191, in forward
    x = self.ln(x)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 31, in forward
    return super().forward(x.float()).type(x.dtype)
KeyboardInterrupt
2022-10-24 14:50:40,181 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:50:40,182 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:50:41,101 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:50:41,114 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:50:42,080 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:50:45,265 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:50:45,268 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:51:45,748 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 305, in _attack_1st_stage
    loss.backward()
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/_tensor.py", line 307, in backward
    torch.autograd.backward(self, gradient, retain_graph, create_graph, inputs=inputs)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/__init__.py", line 154, in backward
    Variable._execution_engine.run_backward(
KeyboardInterrupt
2022-10-24 14:51:51,861 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:51:51,862 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:51:52,816 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:51:52,830 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:51:53,733 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:51:56,925 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:51:56,928 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:53:08,513 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 305, in _attack_1st_stage
    loss.backward()
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/_tensor.py", line 307, in backward
    torch.autograd.backward(self, gradient, retain_graph, create_graph, inputs=inputs)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/__init__.py", line 154, in backward
    Variable._execution_engine.run_backward(
KeyboardInterrupt
2022-10-24 14:53:14,522 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:53:14,523 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:53:15,417 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:53:15,432 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:53:16,406 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:53:19,605 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:53:19,607 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:55:58,602 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 135, in _forward_1st_stage
    val_predictions = self.asr_brain.compute_forward(batch, sb.Stage.VALID)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 70, in compute_forward
    result = self.modules.whisper.model.transcribe(
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 180, in transcribe
    result: DecodingResult = decode_with_fallback(segment)
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 117, in decode_with_fallback
    decode_result = model.decode(segment, options)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 696, in decode
    result = DecodingTask(model, options).run(mel)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 628, in run
    tokens, sum_logprobs, no_speech_probs = self._main_loop(audio_features, tokens)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 586, in _main_loop
    logits = self.inference.logits(tokens, audio_features)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 144, in logits
    res = self.model.decoder(tokens, audio_features, kv_cache=self.kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 189, in forward
    x = block(x, xa, mask=self.mask, kv_cache=kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 124, in forward
    x = x + self.attn(self.attn_ln(x), mask=mask, kv_cache=kv_cache)
KeyboardInterrupt
2022-10-24 14:57:12,640 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 14:57:12,641 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 14:57:13,525 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 14:57:13,539 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 14:57:14,456 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 14:57:18,163 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 14:57:18,166 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:01:10,500 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 135, in _forward_1st_stage
    val_predictions = self.asr_brain.compute_forward(batch, sb.Stage.VALID)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 70, in compute_forward
    result = self.modules.whisper.model.transcribe(
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 180, in transcribe
    result: DecodingResult = decode_with_fallback(segment)
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 117, in decode_with_fallback
    decode_result = model.decode(segment, options)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 696, in decode
    result = DecodingTask(model, options).run(mel)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 628, in run
    tokens, sum_logprobs, no_speech_probs = self._main_loop(audio_features, tokens)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 586, in _main_loop
    logits = self.inference.logits(tokens, audio_features)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 144, in logits
    res = self.model.decoder(tokens, audio_features, kv_cache=self.kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 189, in forward
    x = block(x, xa, mask=self.mask, kv_cache=kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 126, in forward
    x = x + self.cross_attn(self.cross_attn_ln(x), xa, kv_cache=kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 82, in forward
    k = kv_cache.get(self.key, self.key(xa))
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1120, in _call_impl
    result = forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 36, in forward
    return F.linear(
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/functional.py", line 1848, in linear
    return torch._C._nn.linear(input, weight, bias)
KeyboardInterrupt
2022-10-24 15:01:16,856 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 15:01:16,862 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 15:01:17,689 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 15:01:17,711 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 15:01:18,809 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 15:01:21,991 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:01:21,993 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:01:55,357 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 124, in _forward_1st_stage
    predictions = self.asr_brain.compute_forward(batch, rs.Stage.ATTACK)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 75, in compute_forward
    result = self.modules.whisper.model.loss(
  File "/home/rolivier/workspace/whisper/loss.py", line 380, in get_loss_single_segment
    result: LossResult = get_loss_from_mel(
  File "/home/rolivier/workspace/whisper/loss.py", line 138, in get_loss_from_mel
    result = LossTask(model, confidence, correct_first_word, options).run(mel,label)
  File "/home/rolivier/workspace/whisper/loss.py", line 82, in run
    loss, logits, no_speech_probs, sum_logprobs = self._decoder_forward(audio_features, tokens, init_tokens_length)
  File "/home/rolivier/workspace/whisper/loss.py", line 52, in _decoder_forward
    logits = self.inference.logits(tokens[:,:-1], audio_features)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 144, in logits
    res = self.model.decoder(tokens, audio_features, kv_cache=self.kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 189, in forward
    x = block(x, xa, mask=self.mask, kv_cache=kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 127, in forward
    x = x + self.mlp(self.mlp_ln(x))
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 31, in forward
    return super().forward(x.float()).type(x.dtype)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/normalization.py", line 189, in forward
    return F.layer_norm(
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/functional.py", line 2347, in layer_norm
    return torch.layer_norm(input, normalized_shape, weight, bias, eps, torch.backends.cudnn.enabled)
KeyboardInterrupt
2022-10-24 15:01:59,551 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 15:01:59,553 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 15:02:00,231 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 15:02:00,242 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 15:02:01,184 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 15:02:04,345 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:02:04,347 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:02:58,291 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 124, in _forward_1st_stage
    predictions = self.asr_brain.compute_forward(batch, rs.Stage.ATTACK)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 49, in compute_forward
    wavs = self.hparams.smoothing(wavs, wav_lens)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/defenses/smoothing.py", line 43, in __call__
    return self.forward(*args, **kwargs)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/defenses/smoothing.py", line 29, in forward
    x_enh = SmoothCh.apply(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/defenses/smoothing.py", line 65, in forward
    x_np[:x_len] = smooth_np(x_np[:x_len], sigma)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/defenses/smoothing.py", line 55, in smooth_np
    noise = np.random.normal(0, scale=sigma, size=x.shape)
KeyboardInterrupt
2022-10-24 15:03:06,099 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 15:03:06,100 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 15:03:07,011 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 15:03:07,026 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 15:03:07,939 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 15:03:11,113 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:03:11,116 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:04:02,146 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 135, in _forward_1st_stage
    val_predictions = self.asr_brain.compute_forward(batch, sb.Stage.VALID)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 70, in compute_forward
    result = self.modules.whisper.model.transcribe(
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 180, in transcribe
    result: DecodingResult = decode_with_fallback(segment)
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 117, in decode_with_fallback
    decode_result = model.decode(segment, options)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 696, in decode
    result = DecodingTask(model, options).run(mel)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 628, in run
    tokens, sum_logprobs, no_speech_probs = self._main_loop(audio_features, tokens)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 597, in _main_loop
    tokens, completed = self.decoder.update(tokens, logits, sum_logprobs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 259, in update
    next_tokens = Categorical(logits=logits / temperature).sample()
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/distributions/categorical.py", line 64, in __init__
    super(Categorical, self).__init__(batch_shape, validate_args=validate_args)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/distributions/distribution.py", line 52, in __init__
    value = getattr(self, param)
KeyboardInterrupt
2022-10-24 15:04:09,079 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 15:04:09,080 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 15:04:09,990 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 15:04:10,004 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 15:04:10,950 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 15:04:14,131 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:04:14,133 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:05:20,744 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 296, in _attack_1st_stage
    ) = self._forward_1st_stage(
  File "/home/rolivier/workspace/whisper/cw_whisper.py", line 135, in _forward_1st_stage
    val_predictions = self.asr_brain.compute_forward(batch, sb.Stage.VALID)
  File "/home/rolivier/workspace/whisper/sb_whisper_binding.py", line 70, in compute_forward
    result = self.modules.whisper.model.transcribe(
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 180, in transcribe
    result: DecodingResult = decode_with_fallback(segment)
  File "/home/rolivier/workspace/libs/whisper/whisper/transcribe.py", line 117, in decode_with_fallback
    decode_result = model.decode(segment, options)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 696, in decode
    result = DecodingTask(model, options).run(mel)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/grad_mode.py", line 28, in decorate_context
    return func(*args, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 628, in run
    tokens, sum_logprobs, no_speech_probs = self._main_loop(audio_features, tokens)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 586, in _main_loop
    logits = self.inference.logits(tokens, audio_features)
  File "/home/rolivier/workspace/libs/whisper/whisper/decoding.py", line 144, in logits
    res = self.model.decoder(tokens, audio_features, kv_cache=self.kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 189, in forward
    x = block(x, xa, mask=self.mask, kv_cache=kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 124, in forward
    x = x + self.attn(self.attn_ln(x), mask=mask, kv_cache=kv_cache)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 86, in forward
    return self.out(wv)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1102, in _call_impl
    return forward_call(*input, **kwargs)
  File "/home/rolivier/workspace/libs/whisper/whisper/model.py", line 37, in forward
    x, self.weight.to(x.dtype), None if self.bias is None else self.bias.to(x.dtype)
KeyboardInterrupt
2022-10-24 15:06:33,857 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 15:06:33,859 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 15:06:34,797 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 15:06:34,811 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 15:06:35,747 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 15:06:38,925 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:06:38,928 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:07:29,919 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 15:07:29,920 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 15:07:30,640 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 15:07:30,650 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 15:07:30,670 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 15:07:34,184 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:07:34,187 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:08:15,561 - speechbrain.core - ERROR - Exception:
Traceback (most recent call last):
  File "/home/rolivier/workspace/whisper/evaluate.py", line 195, in <module>
    evaluate(hparams_file, run_opts, overrides)
  File "/home/rolivier/workspace/whisper/evaluate.py", line 177, in evaluate
    target_brain.evaluate(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 785, in evaluate
    adv_loss, adv_loss_target = self.evaluate_batch_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 489, in evaluate_batch_adversarial
    predictions, adv_wav = self.compute_forward_adversarial(
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/brain.py", line 305, in compute_forward_adversarial
    adv_wavs = self.attacker.perturb_and_log(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/attacker.py", line 83, in perturb_and_log
    adv_wav = self.perturb(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 188, in perturb
    adv_wav = self._generate_batch(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 210, in _generate_batch
    successful_adv_input_1st_stage = self._attack_1st_stage(batch)
  File "/home/rolivier/workspace/robust_speech/robust_speech/adversarial/attacks/imperceptible.py", line 305, in _attack_1st_stage
    loss.backward()
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/_tensor.py", line 307, in backward
    torch.autograd.backward(self, gradient, retain_graph, create_graph, inputs=inputs)
  File "/home/rolivier/anaconda3/envs/sp3/lib/python3.9/site-packages/torch/autograd/__init__.py", line 154, in backward
    Variable._execution_engine.run_backward(
KeyboardInterrupt
2022-10-24 15:08:21,109 - speechbrain.core - INFO - Beginning experiment!
2022-10-24 15:08:21,110 - speechbrain.core - INFO - Experiment folder: /home/rolivier/workhorse1/robust_speech/attacks/cw_upload/whisper-tiny/2000
2022-10-24 15:08:22,045 - speechbrain.utils.superpowers - DEBUG - aiohttp==3.8.3
aiosignal==1.2.0
antlr4-python3-runtime==4.8
appdirs==1.4.4
async-timeout==4.0.2
attrs==22.1.0
audioread==3.0.0
audlib @ git+https://github.com/RaphaelOlivier/pyaudlib.git@6c9321550e3e1a74081699a8d0770f986647206c
bitarray==2.5.1
brotlipy==0.7.0
certifi @ file:///croot/certifi_1665076670883/work/certifi
cffi @ file:///opt/conda/conda-bld/cffi_1642701102775/work
charset-normalizer==2.0.12
click==8.1.3
colorama==0.4.4
cryptography @ file:///tmp/build/80754af9/cryptography_1652101588893/work
Cython==0.29.30
datasets==2.5.0
decorator==5.1.1
dill==0.3.5.1
editdistance==0.6.0
evaluate==0.2.2
-e git+https://github.com/pytorch/fairseq@2e3c81034937bca63e45338bffc4f14b3267c15a#egg=fairseq
ffmpeg-python==0.2.0
filelock==3.7.1
frozenlist==1.3.1
fsspec==2022.8.2
future @ file:///tmp/build/80754af9/future_1607571303524/work
huggingface-hub==0.10.1
hydra-core==1.0.7
HyperPyYAML==1.0.1
idna @ file:///tmp/build/80754af9/idna_1637925883363/work
jiwer==2.5.1
joblib==1.1.0
Levenshtein==0.20.2
librosa==0.9.2
llvmlite==0.38.1
mkl-fft==1.3.1
mkl-random @ file:///tmp/build/80754af9/mkl_random_1626186066731/work
mkl-service==2.4.0
more-itertools==8.14.0
multidict==6.0.2
multiprocess==0.70.13
numba==0.55.2
numpy==1.22.4
omegaconf==2.0.6
packaging==21.3
pandas==1.5.0
Pillow==9.0.1
pooch==1.6.0
portalocker==2.4.0
pyarrow==9.0.0
pycparser @ file:///tmp/build/80754af9/pycparser_1636541352034/work
pyOpenSSL @ file:///opt/conda/conda-bld/pyopenssl_1643788558760/work
pyparsing==3.0.9
PySocks @ file:///tmp/build/80754af9/pysocks_1605305812635/work
python-dateutil==2.8.2
pytz==2022.4
PyYAML==6.0
rapidfuzz==2.11.1
regex==2022.4.24
requests @ file:///opt/conda/conda-bld/requests_1657734628632/work
resampy==0.2.2
responses==0.18.0
-e git+https://github.com/RaphaelOlivier/robust_speech.git@5f682e51a400bcabbee8ca92d7f089d8b46da5da#egg=robust_speech
ruamel.yaml==0.17.21
ruamel.yaml.clib==0.2.6
sacrebleu==2.1.0
scikit-learn==1.1.2
scipy==1.8.1
sentencepiece==0.1.96
six @ file:///tmp/build/80754af9/six_1644875935023/work
SoundFile==0.10.3.post1
-e git+https://github.com/RaphaelOlivier/speechbrain.git@8811246d729202a0fdf101859e4dab60d04c64c7#egg=speechbrain
tabulate==0.8.9
threadpoolctl==3.1.0
tokenizers==0.12.1
torch==1.10.1
torchaudio==0.10.1
torchvision==0.11.2
tqdm==4.64.0
transformers==4.23.0
typing_extensions @ file:///opt/conda/conda-bld/typing_extensions_1647553014482/work
urllib3 @ file:///tmp/abs_5dhwnz6atv/croots/recipe/urllib3_1659110457909/work
-e git+https://github.com/openai/whisper@d18e9ea5dd2ca57c697e8e55f9e654f06ede25d0#egg=whisper
xxhash==3.0.0
yarl==1.8.1


2022-10-24 15:08:22,058 - speechbrain.utils.superpowers - DEBUG - c868a8d


2022-10-24 15:08:22,087 - robust_speech.data.librispeech - INFO - Skipping preparation, completed in previous run.
2022-10-24 15:08:25,693 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
2022-10-24 15:08:25,695 - speechbrain.core - INFO - 37.2M trainable parameters in WhisperASR
Evaluation stage: TEST - test loss: 2.31, test adv loss: 5.63, test adv loss target: 6.65e-01, test CER: 4.40, test WER: 10.47, test adv CER: 85.40, test adv WER: 98.19, test adv CER target: 13.51, test adv WER target: 17.65, test adv SER target: 17.65
2022-10-24 15:23:16,783 - speechbrain.utils.train_logger - INFO - Evaluation stage: TEST - test loss: 2.31, test adv loss: 5.63, test adv loss target: 6.65e-01, test CER: 4.40, test WER: 10.47, test adv CER: 85.40, test adv WER: 98.19, test adv CER target: 13.51, test adv WER target: 17.65, test adv SER target: 17.65
 - test Adversarial SNR: {'average': 32.82352828979492, 'min_score': 15.0, 'max_score': 42.0}
2022-10-24 15:23:16,830 - speechbrain.utils.train_logger - INFO -  - test Adversarial SNR: {'average': 32.82352828979492, 'min_score': 15.0, 'max_score': 42.0}
